#!/usr/bin/env emacs --script

(message "Run unit tests")

(setq debug-on-error t)

(let ((current-directory (file-name-directory load-file-name)))
  (setq cerbere-test-path (file-name-as-directory (expand-file-name "." current-directory)))
  (setq cerbere-root-path (file-name-as-directory (expand-file-name ".." current-directory))))

(add-to-list 'load-path cerbere-root-path)
(add-to-list 'load-path cerbere-test-path)

(require 'cl)

(dolist (test-file (or argv (directory-files cerbere-test-path t "-test.el$")))
  (unless (string-prefix-p "flycheck_" (file-name-nondirectory test-file))
    (load test-file nil t)))

;; run tests
(ert-run-tests-batch-and-exit t)
